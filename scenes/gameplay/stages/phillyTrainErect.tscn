[gd_scene load_steps=14 format=3 uid="uid://dpm88m7ykgy17"]

[ext_resource type="Script" path="res://scenes/gameplay/stages/phillyTrainErect.gd" id="1_echlm"]
[ext_resource type="Texture2D" uid="uid://b4tkmf8jnndef" path="res://assets/images/gameplay/stages/philly/erect/sky.png" id="2_51iud"]
[ext_resource type="Texture2D" uid="uid://3pdwcagq4d5e" path="res://assets/images/gameplay/stages/philly/erect/city.png" id="3_ukspo"]
[ext_resource type="Texture2D" uid="uid://cgu2nlqtpso0c" path="res://assets/images/gameplay/stages/philly/win.png" id="4_0p77i"]
[ext_resource type="Texture2D" uid="uid://0othmirc3s10" path="res://assets/images/gameplay/stages/philly/train.png" id="5_cp4a6"]
[ext_resource type="Texture2D" uid="uid://ckyj47bq1fhw0" path="res://assets/images/gameplay/stages/philly/erect/behindTrain.png" id="6_ibeb5"]
[ext_resource type="Texture2D" uid="uid://dfx60heg8fiap" path="res://assets/images/gameplay/stages/philly/erect/street.png" id="7_a8udd"]
[ext_resource type="AudioStream" uid="uid://cm361ebiul2ea" path="res://assets/sounds/stages/philly/train.ogg" id="8_87aqq"]

[sub_resource type="Shader" id="Shader_fvbm6"]
code = "shader_type canvas_item;

uniform float hue : hint_range(-360, 360);         // Allow negative hue
uniform float saturation : hint_range(-100, 100);  // Allow negative saturation
uniform float brightness : hint_range(-255, 255);  // Allow negative brightness
uniform float contrast : hint_range(-255, 255);    // Allow negative contrast;

vec3 apply_hue(vec3 color, float hue_angle) {
	float angle = radians(hue_angle);
	vec3 k = vec3(0.57735, 0.57735, 0.57735); // Equal weights for each channel
	float cos_angle = cos(angle);
	return color * cos_angle + cross(k, color) * sin(angle) + k * dot(k, color) * (1.0 - cos_angle);
}

vec3 apply_hsb_effect(vec3 color) {
	// Apply brightness adjustment (negative values will darken the image)
	color = clamp(color + (brightness / 255.0), 0.0, 1.0);

	// Apply hue adjustment (negative values will rotate the hue in the opposite direction)
	color = apply_hue(color, hue);

	// Apply contrast adjustment (negative values will decrease contrast)
	color = clamp((color - 0.5) * (1.0 + (contrast / 255.0)) + 0.5, 0.0, 1.0);

	// Apply saturation adjustment (negative values will desaturate the image)
	vec3 intensity = vec3(dot(color, vec3(0.30980392156, 0.60784313725, 0.08235294117)));
	color = clamp(mix(intensity, color, (1.0 + (saturation / 100.0))), 0.0, 1.0);

	return color;
}

void fragment() {
	// Get the current fragment color (input color)
	vec4 input_color = COLOR;

	// Apply HSB and contrast adjustments with potential negative values
	vec3 out_color = apply_hsb_effect(input_color.rgb);

	// Output the modified color
	COLOR = vec4(out_color * input_color.a, input_color.a);
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rngek"]
shader = SubResource("Shader_fvbm6")
shader_parameter/hue = -26.0
shader_parameter/saturation = -16.0
shader_parameter/brightness = -4.99999
shader_parameter/contrast = null

[sub_resource type="ShaderMaterial" id="ShaderMaterial_b4yj8"]
shader = SubResource("Shader_fvbm6")
shader_parameter/hue = -26.0
shader_parameter/saturation = -16.0
shader_parameter/brightness = null
shader_parameter/contrast = -4.99999

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o2pnb"]
shader = SubResource("Shader_fvbm6")
shader_parameter/hue = -26.0
shader_parameter/saturation = -16.0
shader_parameter/brightness = null
shader_parameter/contrast = -4.99999

[sub_resource type="ShaderMaterial" id="ShaderMaterial_msg4n"]
shader = SubResource("Shader_fvbm6")
shader_parameter/hue = -26.0
shader_parameter/saturation = -16.0
shader_parameter/brightness = null
shader_parameter/contrast = -4.99999

[node name="phillyTrainErect" type="Node2D"]
script = ExtResource("1_echlm")
default_cam_zoom = 1.1

[node name="PL1" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.1, 0.1)

[node name="Sky" type="Sprite2D" parent="PL1"]
z_index = 10
position = Vector2(-100, 0)
texture = ExtResource("2_51iud")
centered = false

[node name="PL2" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.3, 0.3)

[node name="City" type="Sprite2D" parent="PL2"]
z_index = 20
position = Vector2(-10, 0)
scale = Vector2(0.85, 0.85)
texture = ExtResource("3_ukspo")
centered = false

[node name="Win" type="Sprite2D" parent="PL2"]
visible = false
z_index = 30
position = Vector2(-10, 0)
scale = Vector2(0.85, 0.85)
texture = ExtResource("4_0p77i")
centered = false

[node name="PL3" type="Parallax2D" parent="."]

[node name="Train" type="Sprite2D" parent="PL3"]
z_index = 50
material = SubResource("ShaderMaterial_rngek")
position = Vector2(1990, 359)
texture = ExtResource("5_cp4a6")
centered = false

[node name="BehindTrain" type="Sprite2D" parent="PL3"]
z_index = 50
position = Vector2(-50, 50)
texture = ExtResource("6_ibeb5")
centered = false

[node name="Street" type="Sprite2D" parent="PL3"]
z_index = 70
position = Vector2(-50, 50)
texture = ExtResource("7_a8udd")
centered = false

[node name="Character Positions" type="Node2D" parent="."]

[node name="Opponent" type="Node2D" parent="Character Positions"]
z_index = 200
material = SubResource("ShaderMaterial_b4yj8")
position = Vector2(468, 885)

[node name="Spectator" type="Node2D" parent="Character Positions"]
z_index = 100
material = SubResource("ShaderMaterial_o2pnb")
position = Vector2(751.5, 787)

[node name="Player" type="Node2D" parent="Character Positions"]
z_index = 300
material = SubResource("ShaderMaterial_msg4n")
position = Vector2(1020.5, 885)

[node name="train_sound" type="AudioStreamPlayer" parent="."]
stream = ExtResource("8_87aqq")
